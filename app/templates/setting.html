<% extends "head.html" %>
    <% block content %>
        <style>
            .sm-mode {
                display: none;
            }

            .pc-mode {
                display: block;
            }

            @media screen and (max-width:690px) {
                .sm-mode {
                    display: block;
                }

                .pc-mode {
                    display: none;
                }
            }

            .card-header {
                background-color: #ccecf1;
                font-size: 18px;
            }
        </style>


        <div id="app" v-cloak>
            <b-card class="fixed-top header" style="background: rgba(255,255,255,0.5);">
                <b-row>
                    <b-col></b-col>
                    <b-col cols="11">
                        <b-row>
                            <b-col>
                            </b-col>
                            <!-- サイドバー -->
                            <b-col class="text-right">
                                <sc-menu v-if="modeName!='mw'"></sc-menu>
                            </b-col>
                        </b-row>
                    </b-col>
                    <b-col></b-col>
                </b-row>
            </b-card>

            <!-- 空行 -->
            <b-row class="mb-5"></b-row>
            <b-row class="mb-5"></b-row>


            <!-- 新規作成・詳細(更新)ページ -->
            <div>
                <b-row class="mt-5">
                    <b-col></b-col>
                    <!--- 本体 -->
                    <b-col cols=11>
                        <b-card border-variant="white" class="mb-3 text-center" header="会社情報"
                            header-border-variant="light">
                            <b-row>
                                <b-col sm>
                                    <b-form-group label-cols="4" label-cols-lg="2" label-size="sm" label="会社名"
                                        label-for="companyName" label-align="right">
                                        <b-form-input v-model="setting.companyName" id="companyName" size="sm">
                                        </b-form-input>
                                    </b-form-group>
                                </b-col>
                                <b-col sm>
                                    <b-form-group label-cols="4" label-cols-lg="2" label-size="sm" label="代表者名"
                                        label-for="representative" label-align="right">
                                        <b-form-input v-model="setting.representative" id="representative" size="sm">
                                        </b-form-input>
                                    </b-form-group>
                                </b-col>
                            </b-row>
                            <b-row>
                                <b-col sm>
                                    <b-form-group label-cols="4" label-cols-lg="2" label-size="sm" label="郵便番号"
                                        label-for="postNumber" label-align="right">
                                        <b-form-input v-model="setting.postNumber" id="postNumber" size="sm">
                                        </b-form-input>
                                    </b-form-group>
                                </b-col>
                                <b-col sm>
                                    <b-form-group label-cols="4" label-cols-lg="2" label-size="sm" label="住所"
                                        label-for="address" label-align="right">
                                        <b-form-input v-model="setting.address" id="address" size="sm"></b-form-input>
                                    </b-form-group>
                                </b-col>
                            </b-row>
                            <b-row>
                                <b-col sm>
                                    <b-form-group label-cols="4" label-cols-lg="2" label-size="sm" label="電話番号"
                                        label-for="telNumber" label-align="right">
                                        <b-form-input v-model="setting.telNumber" id="telNumber" size="sm">
                                        </b-form-input>
                                    </b-form-group>
                                </b-col>
                                <b-col sm>
                                    <b-form-group label-cols="4" label-cols-lg="2" label-size="sm" label="FAX番号"
                                        label-for="faxNumber" label-align="right">
                                        <b-form-input v-model="setting.faxNumber" id="faxNumber" size="sm">
                                        </b-form-input>
                                    </b-form-group>
                                </b-col>
                            </b-row>
                            <b-row>
                                <b-col sm>
                                    <b-form-group label-cols="4" label-cols-lg="2" label-size="sm" label="ホームページURL"
                                        label-for="url" label-align="right">
                                        <b-form-input v-model="setting.url" id="url" size="sm">
                                        </b-form-input>
                                    </b-form-group>
                                </b-col>
                                <b-col sm>
                                    <b-form-group label-cols="4" label-cols-lg="2" label-size="sm" label="email"
                                        label-for="email" label-align="right">
                                        <b-form-input v-model="setting.email" id="email" size="sm">
                                        </b-form-input>
                                    </b-form-group>
                                </b-col>
                            </b-row>
                        </b-card>

                    </b-col> <!-- 本体 -->
                    <b-col></b-col>

                </b-row>

            </div>

            <div>
                <b-row class="mt-5">
                    <b-col></b-col>
                    <!--- 本体 -->
                    <b-col cols=11>
                        <b-card border-variant="white" class="mb-3 text-center" header="印鑑・ロゴアップロード"
                            header-border-variant="light">
                            会社ロゴをアップロードできます。ロゴはトップページ、サイドバー、見積書・請求書に使用されます。<br>
                            印鑑をアップロードできます。印鑑は見積書・請求書に使用されます。<br>
                            画像サイズは○○×○○以内のものを使用し、PNGまたはJPEG形式のみとなります。
                            <b-row class="mt-5">
                                <b-col cols="1"></b-col>
                                <b-col sm>
                                    <p>会社ロゴ</p>
                                    <img :src="setting.logoFilePath" width="100%">
                                </b-col>
                                <b-col cols="1"></b-col>
                                <b-col sm>
                                    <p>印鑑ロゴ</p>
                                    <img :src="setting.stampFilePath" width="100%">
                                </b-col>
                                <b-col cols="1"></b-col>
                            </b-row>
                            <b-row class="mt-5">
                                <b-col cols="1"></b-col>
                                <b-col sm>
                                    <p>会社ロゴの印刷時の表示</p>
                                    <div class="isPrintDisplay">
                                        <b-form-checkbox v-model="setting.isDisplayQuotationLogo">見積書</b-form-checkbox>
                                        <b-form-checkbox v-model="setting.isDisplayInvoiceLogo">請求書</b-form-checkbox>
                                        <b-form-checkbox v-model="setting.isDisplayDeliveryLogo">納品書</b-form-checkbox>
                                    </div>
                                </b-col>
                                <b-col cols="1"></b-col>
                                <b-col sm>
                                    <p>印鑑ロゴの印刷時の表示</p>
                                    <div class="isPrintDisplay">
                                        <b-form-checkbox v-model="setting.isDisplayQuotationStamp">見積書</b-form-checkbox>
                                        <b-form-checkbox v-model="setting.isDisplayInvoiceStamp">請求書</b-form-checkbox>
                                        <b-form-checkbox v-model="setting.isDisplayDeliveryStamp">納品書</b-form-checkbox>
                                    </div>
                                </b-col>
                                <b-col cols="1"></b-col>
                            </b-row>
                            <b-row class="mt-5">
                                <b-col cols="1"></b-col>
                                <b-col sm>
                                    <p>会社ロゴアップロード</p>
                                    <form action="upload-files/s/asset" class="dropzone" id="logo-dropzone">
                                        <input hidden type="text" name="fileId" v-model="fileId2">

                                        <input hidden type="file" name="file" id="logo-dropzone" multiple>
                                    </form>
                                    <span>ここにロゴ用ファイルをドロップしてください。</span>
                                </b-col>
                                <b-col cols="1"></b-col>
                                <b-col sm>
                                    <p>印鑑ロゴアップロード</p>
                                    <form action="upload-files/s/asset" class="dropzone" id="stamp-dropzone">
                                        <input hidden type="text" name="fileId" v-model="fileId">

                                        <input hidden type="file" name="file" id="stamp-dropzone" multiple>
                                    </form>
                                    <span>ここに印鑑用ファイルをドロップしてください。</span>
                                </b-col>
                                <b-col cols="1"></b-col>
                            </b-row>
                        </b-card>

                        <div>
                            <b-row class="mt-2">
                                <b-button v-if="myUser.role==='crescom_support'" href="/crescom-support-page">
                                    クレスコムサポート画面へ</b-button>
                                <b-button class="ml-1" @click="$bvModal.show('confirmModal');">バージョン情報</b-button>
                            </b-row>
                        </div>

                    </b-col> <!-- 本体 -->
                    <b-col></b-col>

                </b-row>


            </div>
            <!-- 空行 -->
            <b-row class="mb-5"></b-row>
            <b-row class="mb-5"></b-row>
            <b-row class="mb-5"></b-row>

            <!-- 更新・取消ボタンのフッター -->
            <b-card text-variant="white" class="fixed-bottom footer" style="background: rgba(52,58,64,0.9);">
                <b-row>
                    <b-col class="pc-mode">
                        <b-button href="/setting-page">会社情報</b-button>
                        <b-button href="/user-page">ユーザー</b-button>
                        <b-button href="/category-page">カテゴリ</b-button>
                        <b-button href="/maker-page">メーカー</b-button>
                        <b-button href="/unit-page">単位</b-button>
                        <b-button href="/dust-select-page">削除済み</b-button>
                    </b-col>
                    <b-col class="sm-mode">
                        <b-button href="/setting-page" v-b-tooltip.hover.top="'会社情報'">
                            <b-icon icon="building"></b-icon>
                        </b-button>
                        <b-button href="/user-page" v-b-tooltip.hover.top="'ユーザー登録'">
                            <b-icon icon="person-plus-fill"></b-icon>
                        </b-button>
                        <b-button href="/category-page" v-b-tooltip.hover.top="'カテゴリ登録'">
                            <b-icon icon="folder2"></b-icon>
                        </b-button>
                        <b-button href="/maker-page" v-b-tooltip.hover.top="'メーカー登録'">
                            <b-icon icon="shop"></b-icon>
                        </b-button>
                        <b-button href="/unit-page" v-b-tooltip.hover.top="'単位登録'">
                            <b-icon icon="hammer"></i>
                        </b-button>
                        <b-button href="/dust-select-page" v-b-tooltip.hover.top="'削除済み参照'">
                            <b-icon icon="file-earmark-x"></b-icon>
                        </b-button>
                    </b-col>
                    <b-col cols="4" class="text-right">
                        <b-button variant="primary" class="mr-3" @click="bulkUpsert(setting)">保存</b-button>
                    </b-col>
                </b-row>
            </b-card>

            <!-- バージョンモーダル -->
            <div>
                <b-modal id="confirmModal" size="xl" hide-footer>
                    <template #modal-title>
                        バージョン情報
                    </template>
                    <div class="d-block text-center">
                        <p>ver:1.0</p>
                        <p>
                            MIT License
                        </p>
                        <p>
                            Copyright (c) 2021 ohira<br>Copyright (c) 2021 gamasenninn<br>Copyright (c)
                            2021 monomonosu
                        </p>
                        <p>
                            Permission is hereby granted, free of charge, to any person obtaining a copy
                            of this software and associated documentation files (the "Software"), to deal
                            in the Software without restriction, including without limitation the rights
                            to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
                            copies of the Software, and to permit persons to whom the Software is
                            furnished to do so, subject to the following conditions: <br>
                            The above copyright notice and this permission notice shall be included in all
                            copies or substantial portions of the Software. <br>
                            THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
                            IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
                            FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
                            AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
                            LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
                            OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
                            SOFTWARE.
                        </p>
                    </div>
                </b-modal>
            </div>

        </div>

        <script>
            const router = new VueRouter({
            });

            var app = new Vue({
                el: '#app',
                data: {
                    setting: [],                //選択中のsetting
                    myUser: [],                 //ログイン中のユーザー情報
                    fileId: 'stamp',
                    fileId2: 'logo',
                },
                methods: {
                    // ---Settings---
                    bulkUpsert(item) {
                        this.updateSetting(item);
                        this.toast("更新しました");
                    },
                    updateSetting: async function (item) {
                        self = this;
                        await axios.put("/setting/1", item)
                            .then(function (response) {
                                self.getSetting(self.setting);
                                console.log(response);
                            });
                    },
                    getSetting: async function () {
                        self = this;
                        await axios.get("/setting")
                            .then(function (response) {
                                console.log(response);
                                self.setting = response.data
                            });
                    },
                    getLoginUser: async function () {
                        self = this;
                        await axios.get("/login-user")
                            .then(function (response) {
                                console.log(response);
                                self.myUser = response.data;
                            });
                    },
                    toast(toaster, append = false) {
                        this.$bvToast.toast(`${toaster}`, {
                            title: `確認`,
                            toaster: 'b-toaster-top-right',
                            solid: true,
                            appendToast: append,
                        })
                    },
                },
                mounted: function () {
                    this.getSetting();
                    this.getLoginUser();
                    document.querySelector('title').textContent = '各種情報設定';
                },
                router,
                computed: {
                    modeName() {
                        //return this.$route.query.mode;
                        return localStorage.getItem('wMode');
                    },
                }
            })

            Dropzone.options.stampDropzone = {
                dictDefaultMessage: '+',
                init: function () {
                    this.on("complete", file => {
                        console.log("complete A file has been added:", app.fileId2, file);
                        this.removeFile(file);
                        app.setting.stampFilePath = "./static/asset/stamp/" + file.upload.filename
                    });
                }
            };
            Dropzone.options.logoDropzone = {
                dictDefaultMessage: '+',
                init: function () {
                    this.on("complete", file => {
                        console.log("complete A file has been added:", app.fileId, file);
                        this.removeFile(file);
                        app.setting.logoFilePath = "./static/asset/logo/" + file.upload.filename
                    });
                }
            };

        </script>
        <% endblock %>